<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
     integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
     crossorigin="anonymous" referrerpolicy="no-referrer">
    {% if captcha %}
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    {% endif %}
    <script src="{{ url_for('static', filename='func.js') }}"></script>
    <script src="{{ url_for('static', filename='render.js') }}"></script>
    <div>
    </div>
    <link rel="stylesheet" href="{{ url_for('static', filename='main_required.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <style>
        body
        {
            margin: 0;
            background-color: #f0f0f0;
        }
        #head > div
        {
            display: flex;
        }
        #head
        {
            padding: 0 100px;
            width: 100%;
            height: 42px;
            display: flex;
            justify-content: space-between;
            background-color: {{ brand_color }};
        }
        #head-left
        {
            gap: 50px;
        }
        #head-left > *
        {
            line-height: 42px;
            text-align: center;
            color: {{ top_text_color }};
            text-decoration: none;
        }
        #search *
        {
            margin: 0;
            padding: 0;
            height: 42px;
            box-sizing: border-box;
            min-width: 42px;
            border-radius: 0;
            border: #808080 solid 1px;
            box-shadow: none;
            line-height: 40px;
        }
        /*#search *:not([name="search_query"])
        {
            box-sizing: content-box;
        }*/
        #search [name="search_query"]
        {
            padding: 4px 8px;
            box-sizing: border-box;
        }
        #search
        {
            display: flex;
        }
        i
        {
            border: 0 !important;
        }
        #foot div
        {
            margin-left: 50px;
        }
        #user
        {
            width: 42px;
            height: 42px;
        }
        #content
        {
            margin: 5px 50px;
        }
        .title
        {
            display: inline;
            color: #303030;
            margin: 0;
        }
        .namespace
        {
            color: #666;
        }
        #ctn-header
        {
            display: flex;
            justify-content: space-between;
        }
        #menu, #menu2 > div
        {
            display: flex;
        }
        #menu
        {
            height: 35px;
        }
        #menu2 > div
        {
            border: 1px solid black;
            height: 40px;
        }
        #menu2 > div:not(:last-child)
        {
            margin-bottom: 10px;
        }
        #menu a
        {
            border: 1px solid #808080;
            padding: 5px 13px;
            color: unset;
            text-decoration: none;
            line-height: 23px;
        }
        #menu a:not(:last-child), #menu2 a:not(:last-child)
        {
            border-right: 0;
        }
        @media (max-width: 767px)
        {
            .modal
            {
                width: 100%;
            }
        }
        #menu2 a
        {
            padding: 8px 12px;
            line-height: 22px;
        }
        #menu2 a:not(.menu2-selected)
        {
            color: unset;
        }
        .menu2-selected
        {
            color: {{ brand_color }};
        }
        #menu2
        {
            margin: 16px 0;
        }
        #tool-dropdown
        {
            position: relative;
        }
        #tool-dropdown-inner
        {
            position: absolute;
            background-color: white;
            display: none;
            width: max-content;
        }
        #tool-dropdown-checkbox
        {
            display: none;
        }
        #tool-dropdown-checkbox:checked ~ #tool-dropdown-inner
        {
            display: block;
        }
        #tool-dropdown-inner a
        {
            display: block;
            color: black;
            line-height: 1.5;
            text-align: left;
            padding: 3px 20px;
        }
        #tool-dropdown-inner a:hover
        {
            color: white;
            transition: .1s;
            background-color: {{ brand_color }};
        }
        </style>
    {% block css %}{% endblock %}
    <title>{{ wiki_name }}</title>
</head>
<body>
    <div id="modal_background" style="display: none;"></div>
    {% block outcontent %}{% endblock %}
    <div id="head">
        <div id="head-left">
            <a href="/">{{ wiki_name }}</a>
            <!--
            <a href="/license">LICENSE</a>
            {% if has_perm("admin") %}
            <a href="/admin_tool">관리 도구</a>
            {% endif %}
            -->
            <a href="{{ url_for('recent_changes') }}">최근 변경</a>
            <a href="{{ url_for('recent_discuss') }}">최근 토론</a>
            <a href="{{ url_for('random_document') }}">임의 문서</a>
            <div id="tool-dropdown">
                <label style="cursor: pointer;" for="tool-dropdown-checkbox">특수 기능</label>
                <input id="tool-dropdown-checkbox" type="checkbox">
                <div id="tool-dropdown-inner">
                    {% for i in special_function %}
                    <a href="{{ i[1] }}">{{ i[0] }}</a>
                    {% endfor %}
                </div>
            </div>
        </div>
        <div id="head-right">
            <form id="search" action="{{ url_for('go') }}" method="get"> <!-- 검색 창 -->
                <button type="button">
                    <i class="fa-solid fa-shuffle"></i>
                </button>
                <input type="text" name="q" style="padding-left: 5px;">
                <button type="submit">
                    <i class="fa-solid fa-magnifying-glass"></i>
                </button>
                <button type="button">
                    <i class="fa-solid fa-arrow-right"></i>
                </button>
            </form>
            <button id="user">
                <i class="fa-solid fa-user"></i>
            </button>
        </div>
    </div>
    <div id="content">
        <div id="ctn-header">
            <div>
                <h1 class="title">{{ title|safe }}</h1>
                {% if subtitle is defined %}
                <h2 class="title" style="margin-left: 8px;">({{ subtitle }})</h2>
                {% endif %}
            </div>
            {% if menu is defined %}
            <div id="menu">
                {% for i in menu %}
                <a href="{{ i.link }}" class="{{ i.clas }}" style="{{ i.style }}">{{ i.name }}</a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
        <div id="ctn-data">
        {% if menu2 is defined %}
        <div id="menu2">
            {% for m in menu2 %}
            <div>
                {% for i in m %}
                <a href="{{ i.link }}" class="{{ i.clas }}" style="{{ i.style }}">{{ i.name }}</a>
                {% endfor %}
            </div>
            {% endfor %}
        </div>
        {% endif %}
            {% block content %}{% endblock %}
        </div>
    </div>
    <div id="foot">
        <hr>
        <div>
            NewTheSeed {{ version }}
        </div>
        <div>
            {{ document_license|safe }}
        </div>
    </div>
    <script>
        function closeModal(id) {
            document.getElementById(id).style.display = "none"
            document.getElementById("modal_background").style.display = "none";
        }
        function openModal(id) {
            document.getElementById(id).style.display = "block"
            document.getElementById("modal_background").style.display = "block";
        }
        function onCaptchaCompleted(token) {
            document.getElementById("on-captcha").style.display = "block";
        }
        function callapi(href, body, then) {
            fetch(href, {"method": "post",
            "headers": {"Content-Type": "application/json"},
            "body": JSON.stringify(body)})
            .then(r => {
                if (r.ok) return r.json()
                else if (r.status == 400) return r.text().then(t => {throw new Error(t)}) 
                else throw new Error(`Request failed with status code ${r.status}`)
            })
            .then(then)
            .catch(e => {alert(e.message)})
        }
        document.querySelector("#head div:nth-child(2) form button:nth-child(4)").addEventListener("click", function () {
            location.href = `/w/${encodeURI(document.querySelector("#head div:nth-child(2) form input").value)}`
        })
        document.querySelector("#user").addEventListener("click", function () {
            location.href = '/user'
        })
        document.querySelectorAll(".confirm:not(.refresh-on-submit)").forEach(function (b) {
            b.addEventListener("submit", function (e) {
                if (!confirm("msg" in this.dataset ? this.dataset["msg"] : "계속하시겠습니까?")) {
                    e.preventDefault();
                }
            })
        })
        document.querySelectorAll(".refresh-on-submit").forEach(function (form) {
            form.addEventListener("submit", function (e) {
                e.preventDefault();
                if (this.classList.contains("confirm")) {
                    if (!confirm("msg" in this.dataset ? this.dataset["msg"] : "계속하시겠습니까?")) {
                        return
                    }
                }
                fetch(this.action, {method: this.method, body: new FormData(this)})
                .then((r) => {
                    if (r.ok) {
                        if ("customRedirect" in this.dataset) {
                            location.href = this.dataset.customRedirect
                        }
                        else {
                            location.reload()
                        }
                    }
                    else {
                        if (r.status >= 400 && r.status <= 499 && r.headers.get("Content-Type").startsWith("text/plain")) {
                            r.text().then(function (err) {
                                alert(err)
                            })
                        }
                        else {
                            alert(`Request failed with status code ${r.status}`)
                        }
                    }
                })
            })
        })
        document.body.addEventListener("click", function (e) {
            var t = e.target.closest(".toggle-button");
            if (t) {
                var target = document.getElementById(t.dataset.target);
                target.hidden = !target.hidden;
            }
        })
    </script>
    {% if req_captcha and captcha_time %}
    <script>
        setTimeout(function () {
            document.getElementById("on-captcha").style.display = "none";
            document.getElementsByClassName("g-recaptcha")[0].style.display = "block";
        }, 10);
    </script>
    {% endif %}
    {% block js %}{% endblock %}
</body>
</html>